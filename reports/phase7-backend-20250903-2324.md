## Phase-7 Backend Report — 2025-09-03 23:24

### Summary
- Implemented Payroll endpoints and core calc utilities
- Implemented WMS endpoints (putaway, labels)
- Implemented MFG endpoints (MRP, Capacity, APS)
- Hardened auth/login (NextAuth App Router; credentials + Google + Microsoft) and resolved duplicate route/favicon conflicts
- Added seeds (employees) and PDF/BACS generators
- Added unit tests for payroll calculators and BACS; full test suite green

### Routes added/updated (App Router)
- POST /api/payroll/run — create run and generate payslips
- GET  /api/payroll/payslips?runId=…
- GET  /api/payroll/export/bacs?runId=…
- POST /api/wms/putaway — upsert inventory qty
- POST /api/wms/labels — generate label payloads
- POST /api/mfg/mrp — generate MRP plan rows
- POST /api/mfg/capacity — upsert capacity calendar (resource/day)
- POST /api/mfg/aps — plan routing step for a work order

All routes include: Zod validation, RBAC guard, correlationId, masked audit logs, JSON `{ ok: true/false, … }` responses.

### Auth/login
- NextAuth v5 App Router `{ GET, POST }` with credentials, google, azure-ad
- Custom `/login` client page: credentials form + OAuth buttons
- `/auth/signin` redirects to `/login` via page file

### Seeds & Utilities
- apps/web/scripts/seedEmployees.ts (admin seed exists from earlier step)
- Payslip PDF via pdf-lib; BACS CSV generator
- Shared parseBody util for resilient JSON/form parsing

### Environment
- DATABASE_URL set to `postgresql://postgres:postgres@localhost:5432/optra?schema=public`
- NEXTAUTH_URL=http://localhost:3000; NEXTAUTH_SECRET set locally

### Tests & Gates
- Unit tests: 81 passed (includes new payroll calculator + BACS tests)
- Lint/typecheck: OK (no new lints introduced)

### Result
- RESULT: PASS

### Notes / Next steps
- Extend CRM sync and billing endpoints per scope (pending)
- Add more fixtures and golden JSONs for happy paths


