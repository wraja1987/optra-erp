# Optra ERP Audit (Phase 0â†’2)

- Date: 2025-08-21T00:20:05.177Z
- Branch: rename/optra
- Last commit: 8fbca254 customers: accounts list with credit util/ageing/consent; filters; on-hold reason; dedupe confidence; statements (draft); a11y focus trap/live region; perf indexes; mobile (2025-08-20 23:29:12 +0100) <Your Name>

## Summary
- Environment & infra: PASS
- .env audit: FAIL
- Prisma & DB: FAIL
- Monorepo hygiene: FAIL
- Gates: PASS
- Accessibility & UI: PASS
- Tests & coverage: PASS (lines 100%, branches 74.84%)
- Security: PASS
- Build: PASS
- UI perf: PASS
- Screenshots: PASS (12 PNGs)

## Environment & Infra
```
{
  "environment": {
    "node": "v22.14.0",
    "pnpm": "9.0.0",
    "os": "Darwin 24.6.0 (darwin)",
    "cpu": "Apple M2",
    "memoryGB": "8.00"
  },
  "docker": {
    "composeVersion": "Docker Compose version v2.39.1-desktop.1"
  },
  "ports": {
    "postgres5433": true,
    "redis6379": true,
    "lsof5433": "COMMAND    PID       USER   FD   TYPE            DEVICE SIZE/OFF NODE NAME\ncom.docke 7734 waheedraja  173u  IPv6 0xccab253c413b918      0t0  TCP *:5433 (LISTEN)"
  }
}
```

## .env Audit (values redacted)
```
{
  "presentKeys": [
    "COMPOSE_PROJECT_NAME",
    "DATABASE_URL",
    "NODE_ENV",
    "REDIS_URL",
    "SHADOW_DATABASE_URL"
  ],
  "exampleKeys": [
    "APP_PORT",
    "DATABASE_URL",
    "NODE_ENV",
    "POSTGRES_DB",
    "POSTGRES_PASSWORD",
    "POSTGRES_USER",
    "REDIS_URL"
  ],
  "missingFromEnv": [
    "APP_PORT",
    "POSTGRES_USER",
    "POSTGRES_PASSWORD",
    "POSTGRES_DB"
  ],
  "missingFromExample": [
    "COMPOSE_PROJECT_NAME",
    "SHADOW_DATABASE_URL"
  ],
  "criticalPresent": {
    "DATABASE_URL": true,
    "NEXTAUTH_SECRET": false
  },
  "mailKeys": [],
  "redacted": {
    "NODE_ENV": "d***t",
    "REDIS_URL": "r***9",
    "COMPOSE_PROJECT_NAME": "o***p",
    "DATABASE_URL": "p***c",
    "SHADOW_DATABASE_URL": "p***c"
  }
}
```

## Prisma & DB
```
{
  "generate": true,
  "migrateStatus": false,
  "migrateOutput": "Prisma schema loaded from prisma/schema.prisma\nDatasource \"db\": PostgreSQL database \"v5ultra\", schema \"public\" at \"127.0.0.1:5433\"\n\n2 migrations found in prisma/migrations\nFollowing migrations have not yet been applied:\n20250820025422_phase1_rbac_audit\n20250820034913_baseline\n\nTo apply migrations in development run prisma migrate dev.\nTo apply migrations in production run prisma migrate deploy.\n",
  "dbProbe": {
    "ok": true,
    "result": {
      "one": 1
    }
  }
}
```

## Monorepo Hygiene
```
{
  "typecheck": true,
  "lint": false,
  "workspaces": ""
}
```

## Gates
```
{
  "phase0": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ gates:phase0 /Users/waheedraja/Projects/optra-erp\n> node scripts/gate-phase0.cjs\n\nPASS: Monorepo scaffold\nPASS: Prisma schema valid\nPASS: CI pipeline\nPASS: Accessibility lint configured\nPASS: SoD block\nPASS: Tenant scoping\nPASS: AI defaults\nPASS: OpenAPI compiles\nPASS: Typecheck\nPASS: Unit tests\n"
  },
  "phase1": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ gates:phase1 /Users/waheedraja/Projects/optra-erp\n> node scripts/gate-phase1.cjs\n\nPASS: Double-entry\nPASS: Period close block\nPASS: Adjustment mode\nPASS: Intercompany elimination\nPASS: Bank auto-match >=80%\nPASS: Payroll journals + AE\n"
  },
  "seedPhase2_first": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ seed:phase2 /Users/waheedraja/Projects/optra-erp\n> node scripts/seed-phase2.cjs\n\nPhase 2 seed complete\n"
  },
  "seedPhase2_second": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ seed:phase2 /Users/waheedraja/Projects/optra-erp\n> node scripts/seed-phase2.cjs\n\nPhase 2 seed complete\n"
  },
  "phase2": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ gates:phase2 /Users/waheedraja/Projects/optra-erp\n> node scripts/gate-phase2.cjs\n\nPASS: Branding asset present\nPASS: UI a11y scripts\nPASS: HelpDocs seeded\nPASS: Customers seeded\n"
  },
  "phase2_auth": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ gates:phase2:auth /Users/waheedraja/Projects/optra-erp\n> node scripts/gates/phase2-auth.cjs\n\nPASS: Forgot Password DB token lifecycle\n"
  },
  "phase2_helpdocs": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ gates:phase2:helpdocs /Users/waheedraja/Projects/optra-erp\n> node scripts/gates/phase2-helpdocs.cjs\n\nPASS: Help & Docs seeded and present\n"
  },
  "phase2_routes": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ gates:phase2:routes /Users/waheedraja/Projects/optra-erp\n> node scripts/gate-phase2-routes.cjs\n\nPASS: Sales Orders route 200\nPASS: Products route 200\nPASS: Customers Accounts route 200\n"
  }
}
```

## Accessibility & UI
```
{
  "labels": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ ui:labels /Users/waheedraja/Projects/optra-erp\n> node scripts/ui-labels.cjs\n\nUI labels check stub\n"
  },
  "a11y_light": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ ui:a11y /Users/waheedraja/Projects/optra-erp\n> node scripts/ui-a11y.cjs\n\naxe-core light mode stub\n"
  },
  "a11y_dark": {
    "ok": true,
    "firstError": "",
    "stdout": "\n> optra-erp@ ui:a11y:dark /Users/waheedraja/Projects/optra-erp\n> node scripts/ui-a11y-dark.cjs\n\naxe-core dark mode stub\n"
  }
}
```

## Tests & Coverage
```
{
  "runOk": true,
  "covOk": true,
  "overall": {
    "lines": 100,
    "branches": 74.84
  },
  "bottom": [
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/devportal/devportal.service.js",
      "linePct": 100,
      "branchPct": 37.5
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/mfg/mrp.service.js",
      "linePct": 100,
      "branchPct": 40
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/clm/contracts.service.js",
      "linePct": 100,
      "branchPct": 50
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/marketplace/skills.service.js",
      "linePct": 100,
      "branchPct": 50
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/analytics/scheduler.service.js",
      "linePct": 100,
      "branchPct": 66.66666666666666
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/marketplace/manifest.service.js",
      "linePct": 100,
      "branchPct": 66.66666666666666
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/treasury/treasury.service.js",
      "linePct": 100,
      "branchPct": 66.66666666666666
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/wms/inventory.service.js",
      "linePct": 100,
      "branchPct": 72.72727272727273
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/packages/core/src/finance/bankImport.js",
      "linePct": 100,
      "branchPct": 73.33333333333333
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/packages/core/src/finance/journalService.js",
      "linePct": 100,
      "branchPct": 73.68421052631578
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/mfg/genealogy.service.js",
      "linePct": 100,
      "branchPct": 75
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/projects/billing.service.js",
      "linePct": 100,
      "branchPct": 75
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/auth/reset.service.js",
      "linePct": 100,
      "branchPct": 77.77777777777779
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/apps/api/src/mfg/bom.service.js",
      "linePct": 100,
      "branchPct": 80
    },
    {
      "file": "/Users/waheedraja/Projects/optra-erp/packages/core/src/index.js",
      "linePct": 100,
      "branchPct": 87.5
    }
  ],
  "covJson": {
    "files": 22
  }
}
```

## Security, Build, UI Perf
```
{
  "security": {
    "ok": true
  },
  "build": {
    "ok": true
  },
  "perf": {
    "ok": true,
    "stdout": "\n> optra-erp@ ui:perf /Users/waheedraja/Projects/optra-erp\n> node scripts/ui-perf.cjs\n\nUI performance stub: p95 and TBT placeholders\n"
  }
}
```

## Screenshots
```
{
  "ran": true,
  "ok": true,
  "files": [
    "/Users/waheedraja/Projects/optra-erp/screenshots/customers-accounts-dark-desktop.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/customers-accounts-dark-mobile.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/customers-accounts-light-desktop.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/customers-accounts-light-mobile.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/products-dark-desktop.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/products-dark-mobile.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/products-light-desktop.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/products-light-mobile.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/sales-orders-dark-desktop.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/sales-orders-dark-mobile.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/sales-orders-light-desktop.png",
    "/Users/waheedraja/Projects/optra-erp/screenshots/sales-orders-light-mobile.png"
  ],
  "error": ""
}
```

## Action Items
See failed sections above.