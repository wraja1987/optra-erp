## Nexa ERP Auth Diagnostics (2025-09-03 22:18)

### Found routes
- NextAuth handler: `apps/web/pages/api/auth/[...nextauth].ts` (present)
- Custom login page: `apps/web/src/app/login/page.tsx` (present)
- Favicon conflict: removed `apps/web/src/app/favicon.ico` and `apps/web/src/app/(public)/favicon.ico`; kept `apps/web/public/favicon.ico`

### Env handling
- next config: `apps/web/next.config.ts` exposes `NEXTAUTH_URL`, `NEXTAUTH_SECRET`, `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`, `MICROSOFT_CLIENT_ID`, `MICROSOFT_CLIENT_SECRET`, `MICROSOFT_TENANT_ID`
- `.env.local` (apps/web): placeholders detected for provider creds and secret
  - `NEXTAUTH_URL`: http://localhost:3000
  - `NEXTAUTH_SECRET`: REPLACE_WITH_RANDOM_BASE64 (placeholder)
  - `GOOGLE_CLIENT_ID/SECRET`: placeholders
  - `MICROSOFT_CLIENT_ID/SECRET`: placeholders
- Root `.env`: defines a `NEXTAUTH_SECRET`, but provider IDs are empty

### Login pages
- `/login` page includes buttons calling `signIn('google')` and `signIn('azure-ad')`
- NextAuth pages config sets `signIn: "/login"` so `/auth/signin` redirects to the custom page

### Smoke test
- Added: `apps/web/src/__tests__/auth.smoke.test.ts`
- Ran: `pnpm -w test`
- Result: FAIL â€” `getProviders()` returned null (fetch to `http://localhost:3000/api/auth/providers` failed; server not running in test env)

### Result
- FAIL

### Next steps
1) Provide real credentials in `apps/web/.env.local` (or root env) and restart dev:
   - `NEXTAUTH_SECRET` (generate: `openssl rand -base64 32`)
   - `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET`
   - `MICROSOFT_CLIENT_ID`, `MICROSOFT_CLIENT_SECRET`, `MICROSOFT_TENANT_ID` (typically `common` or your tenant GUID)
2) Start the web app: `pnpm --filter web dev` and visit `/login`.
3) Verify providers endpoint: `curl http://localhost:3000/api/auth/providers` should list `google` and `azure-ad`.
4) If tests must assert providers without a running server, mock `getProviders` or spin up a dev server in test setup.


